{% extends 'base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'web:dashboard' %}">Home</a></li>
<li class="breadcrumb-item">Reports</li>
<li class="breadcrumb-item active">Essentials</li>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-white">
                    <h4 class="card-title mb-0">{{ title }}</h4>
                    <p class="text-muted mb-0">{{ subtitle }}</p>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        The report generation system is currently being updated. Please check back later.
                    </div>
                    <div class="row g-4">
                        <!-- Baptism Record -->
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-water fa-2x text-primary me-3"></i>
                                        <h5 class="card-title mb-0">Infant Baptism Record</h5>
                                    </div>
                                    <p class="card-text text-muted">Generate an infant baptism record certificate with all required information.</p>
                                    <a href="{% url 'reports:baptism_record_form' %}" class="btn btn-primary">
                                        <i class="fas fa-file-pdf me-2"></i>Generate Record
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ripper Years Record -->
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-book fa-2x text-success me-3"></i>
                                        <h5 class="card-title mb-0">Ripper Years Record</h5>
                                    </div>
                                    <p class="card-text text-muted">Generate a ripper years baptism certificate with all required information.</p>
                                    <a href="{% url 'reports:ripper_years_form' %}" class="btn btn-success">
                                        <i class="fas fa-file-pdf me-2"></i>Generate Record
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Family Report -->
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-users fa-2x text-info me-3"></i>
                                        <h5 class="card-title mb-0">Family Report</h5>
                                    </div>
                                    <p class="card-text text-muted">Generate a comprehensive family report for the selected church with member details.</p>
                                    <a href="{% url 'reports:family_report_form' %}" class="btn btn-info">
                                        <i class="fas fa-file-pdf me-2"></i>Generate Report
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Birthday Celebration Report -->
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-birthday-cake fa-2x text-danger me-3"></i>
                                        <h5 class="card-title mb-0">Birthday Celebration Report</h5>
                                    </div>
                                    <p class="card-text text-muted">Generate a report of families with birthday celebrants for the selected date range.</p>
                                    
                                    <form id="birthdayReportForm" method="post" action="{% url 'reports:birthday_report' %}" class="mt-3">
                                        {% csrf_token %}
                                        <div class="mb-3">
                                            <label for="church" class="form-label">Select Church</label>
                                            <select id="church" name="church" class="form-select" required>
                                                <option value="">Select Church</option>
                                                <!-- Churches will be loaded via AJAX -->
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="start_date" class="form-label">Start Date</label>
                                            <input type="date" id="start_date" name="start_date" class="form-control" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="end_date" class="form-label">End Date</label>
                                            <input type="date" id="end_date" name="end_date" class="form-control" required>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button type="submit" name="action" value="download" class="btn btn-danger">
                                                <i class="fas fa-download me-2"></i>Download
                                            </button>
                                            <button type="submit" name="action" value="view" class="btn btn-outline-danger">
                                                <i class="fas fa-eye me-2"></i>View
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Wedding Anniversary Celebration Report -->
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-ring fa-2x text-warning me-3"></i>
                                        <h5 class="card-title mb-0">Wedding Anniversary Report</h5>
                                    </div>
                                    <p class="card-text text-muted">Generate a report of families with wedding anniversary celebrants for the selected date range.</p>
                                    
                                    <form id="weddingReportForm" method="post" action="{% url 'reports:wedding_report' %}" class="mt-3">
                                        {% csrf_token %}
                                        <div class="mb-3">
                                            <label for="wedding_church" class="form-label">Select Church</label>
                                            <select id="wedding_church" name="church" class="form-select" required>
                                                <option value="">Select Church</option>
                                                <!-- Churches will be loaded via AJAX -->
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="wedding_start_date" class="form-label">Start Date</label>
                                            <input type="date" id="wedding_start_date" name="start_date" class="form-control" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="wedding_end_date" class="form-label">End Date</label>
                                            <input type="date" id="wedding_end_date" name="end_date" class="form-control" required>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button type="submit" name="action" value="download" class="btn btn-warning">
                                                <i class="fas fa-download me-2"></i>Download
                                            </button>
                                            <button type="submit" name="action" value="view" class="btn btn-outline-warning">
                                                <i class="fas fa-eye me-2"></i>View
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Set default date range (current month) for birthday report
        const today = new Date();
        const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
        const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
        
        // Format dates as YYYY-MM-DD for input[type="date"]
        document.getElementById('start_date').value = firstDay.toISOString().split('T')[0];
        document.getElementById('end_date').value = lastDay.toISOString().split('T')[0];
        
        // Set the same default date range for wedding report
        document.getElementById('wedding_start_date').value = firstDay.toISOString().split('T')[0];
        document.getElementById('wedding_end_date').value = lastDay.toISOString().split('T')[0];
        
        // Load churches for the birthday report
        fetch('{% url "reports:api_churches" %}')
            .then(response => response.json())
            .then(data => {
                const churchSelect = document.getElementById('church');
                const weddingChurchSelect = document.getElementById('wedding_church');
                
                data.forEach(church => {
                    // Add to birthday report dropdown
                    const option = document.createElement('option');
                    option.value = church.id;
                    option.textContent = church.name;
                    churchSelect.appendChild(option);
                    
                    // Add to wedding report dropdown
                    const weddingOption = document.createElement('option');
                    weddingOption.value = church.id;
                    weddingOption.textContent = church.name;
                    weddingChurchSelect.appendChild(weddingOption);
                });
            })
            .catch(error => {
                console.error('Error loading churches:', error);
            });
    });
</script>
{% endblock %} 