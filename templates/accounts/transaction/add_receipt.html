{% extends 'base.html' %}

{% block title %}Add Receipt - {{ account.name }}{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'web:dashboard' %}">Home</a></li>
<li class="breadcrumb-item"><a href="{% url 'accounts:pastorate_list' %}">Pastorates</a></li>
{% if account.level == 'pastorate' %}
<li class="breadcrumb-item"><a href="{% url 'accounts:pastorate_detail' pk=account.pastorate.id %}">{{ account.pastorate.pastorate_name }}</a></li>
{% else %}
<li class="breadcrumb-item"><a href="{% url 'accounts:pastorate_detail' pk=account.church.pastorate.id %}">{{ account.church.pastorate.pastorate_name }}</a></li>
<li class="breadcrumb-item"><a href="{% url 'accounts:church_detail' pk=account.church.id %}">{{ account.church.church_name }}</a></li>
{% endif %}
<li class="breadcrumb-item"><a href="{% url 'accounts:account_detail' pk=account.id %}">{{ account.name }}</a></li>
<li class="breadcrumb-item active">Add Receipt</li>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <h5 class="mb-0">Add New Receipt</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="category" value="{{ receipt_category.id }}">
                        
                        <div class="mb-3">
                            <label class="form-label">Receipt Number</label>
                            <input type="text" name="reference_number" class="form-control" placeholder="Enter receipt number" required>
                            <div class="form-text">Enter the receipt number</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Member Reference (Optional)</label>
                            <select name="member_id" class="form-select" id="member_select">
                                <option value="">Select a member...</option>
                                {% for member in members %}
                                <option value="{{ member.id }}">
                                    {{ member.respect.name }} {{ member.name }} - {{ member.family.area.area_name }}
                                    {% if account.level == 'pastorate' %} 
                                    - {{ member.family.area.church.church_name }}
                                    {% endif %}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="form-text">Select a member from the list</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Family Reference (Optional)</label>
                            <select name="family_id" class="form-select" id="family_select">
                                <option value="">Select a family...</option>
                                {% for family in families %}
                                <option value="{{ family.id }}">
                                    {{ family.respect.name }} {{ family.family_head }}'s Family - {{ family.area.area_name }}
                                    {% if account.level == 'pastorate' %}
                                    - {{ family.area.church.church_name }}
                                    {% endif %}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="form-text">Select a family from the list</div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Amount</label>
                            <div class="input-group">
                                <span class="input-group-text">â‚¹</span>
                                <input type="number" name="amount" class="form-control" step="0.01" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Transaction Date</label>
                            <input type="date" name="transaction_date" class="form-control" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea name="description" class="form-control" rows="3"></textarea>
                            <div class="form-text">Please provide a detailed description of the receipt.</div>
                        </div>

                        <div class="text-end">
                            <a href="{% url 'accounts:account_detail' pk=account.id %}" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary">Create Receipt</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set default transaction date to current date
    const now = new Date();
    const today = now.toISOString().split('T')[0];
    document.querySelector('input[name="transaction_date"]').value = today;

    // Handle member and family select interaction
    const memberSelect = document.getElementById('member_select');
    const familySelect = document.getElementById('family_select');

    memberSelect.addEventListener('change', function() {
        if (this.value) {
            familySelect.value = '';
            familySelect.disabled = true;
        } else {
            familySelect.disabled = false;
        }
    });

    familySelect.addEventListener('change', function() {
        if (this.value) {
            memberSelect.value = '';
            memberSelect.disabled = true;
        } else {
            memberSelect.disabled = false;
        }
    });
});
</script>

<style>
.form-select {
    padding: 0.5rem;
}

.form-select option {
    padding: 0.5rem;
}

/* Add a search icon to the select dropdowns */
.form-select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 1rem;
}
</style>
{% endblock %} 